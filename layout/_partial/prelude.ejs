<% if (config.author) { %>
    <script src="//cdnjs.cloudflare.com/ajax/libs/gsap/2.1.3/TweenMax.min.js"></script>
	<%- js('scripts/leon.js') %>

	<script>
		const ONE_HOUR = 60 * 60 * 1000

		let leon, canvas, ctx

		const sw = window.innerWidth
		const sh = window.innerHeight
		const pixelRatio = window.devicePixelRatio

		function init() {
		  canvas = document.createElement('canvas')
		  canvas.classList.add('prelude')
		  document.body.appendChild(canvas)
		  ctx = canvas.getContext('2d')

		  canvas.width = sw * pixelRatio
		  canvas.height = sh * pixelRatio
		  canvas.style.width = sw + 'px'
		  canvas.style.height = sh + 'px'
		  ctx.scale(pixelRatio, pixelRatio)

		  leon = new LeonSans({
			text: 'Cold Stone',
			color: ['#000000'],
			size: 80,
			weight: 200
		  })

		  requestAnimationFrame(draw)
		}

		function draw(t) {
		  requestAnimationFrame(draw)

		  ctx.clearRect(0, 0, sw, sh)

		  const x = (sw - leon.rect.w) / 2
		  const y = (sh - leon.rect.h) / 2
		  leon.position(x, y)

		  leon.draw(ctx)
		}

		function animate() {
			const total = leon.drawing.length

			for (let i = 0; i < total; i++) {
				TweenMax.fromTo(
					leon.drawing[i],
					1.6,
					{ value: 0 },
					{
						delay: i * 0.05,
						value: 1,
						ease: Power4.easeOut
					}
				)
			}


			const timeout = setTimeout(function() {
				clearTimeout(timeout)
				document.body.removeChild(canvas)
				localStorage.setItem('animatedTime', Date.now())
			}, 1600)
		}

		const animatedTime = localStorage.getItem('animatedTime')

		if(!animatedTime || Date.now() > parseInt(animatedTime) + ONE_HOUR) {
			init()
			animate()
		}
	</script>
<% } %>
